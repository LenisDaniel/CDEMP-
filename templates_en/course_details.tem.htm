<div class="row">
    <div class="col-md-12">
        <!-- BEGIN EXAMPLE TABLE PORTLET-->
        <div class="portlet box red">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-users"></i>Students List
                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse">
                    </a>

                    <a href="javascript:;" class="reload">
                    </a>

                </div>
            </div>
            <div class="portlet-body">

                <form action="includes/course_details.inc.php" method="post">
                    <div class="table-toolbar">
                        <div class="row">
                            <div class="col-md-6">
                                <!-- <div class="btn-group">
                                    <button id="sample_editable_1_new" class="btn green">
                                    Add New <i class="fa fa-plus"></i>
                                    </button>
                                </div> -->
                            </div>
                            <div class="col-md-6">
                                <button type="submit" id="submit_notifications" class="btn btn-primary pull-right">Submit</button>
                                <div class="btn-group pull-right" style="margin-right: 10px">
                                    <button class="btn dropdown-toggle" data-toggle="dropdown">Tools <i class="fa fa-angle-down"></i>
                                    </button>
                                    <ul class="dropdown-menu pull-right">
                                        <li>
                                            <a href="#">
                                                Print </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                Save as PDF </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                Export to Excel </a>
                                        </li>
                                    </ul>
                                </div>
                                <input type="text" class="form-control pull-right" style="width: 180px; margin-right: 20px;" id="day_status_date" name="day_status_date" placeholder="Forget Create?">
                            </div>
                        </div>
                    </div>
                    <div style="overflow: scroll">

                        <table class="table table-striped table-bordered" data-toggle="table" data-pagination="true" id="students_table">
                            <thead>
                            <tr>
                                <th>
                                    ID
                                </th>
                                <th>
                                    Student Name
                                </th>
                                <th>
                                    Day Status
                                </th>
                                <th>
                                    Incidents
                                </th>
                                <th>
                                    Insert Grade
                                </th>
                            </tr>
                            </thead>
                            <tbody>

                            {students_list}

                            </tbody>
                        </table>

                    </div>
                    <input type="hidden" name="grade" id="grade" value="{grade}">
                    <input type="hidden" name="group" id="group" value="{group}">
                    <input type="hidden" name="course" id="course" value="{course}">
                    <input type="hidden" name="teacher" id="teacher" value="{teacher}">
                    <input type="hidden" name="form_action1" id="form_action1" value="1">
                    <img src="assets2/global/img/ajax-loader.gif" id="loading_image" class="ajax_loader" style="display:none">
                </form>

            </div>
        </div>
        <!-- END EXAMPLE TABLE PORTLET-->

        <!--Aqui creamos el modal para insertar la nota-->
        <div class="modal fade" id="create_grade" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">Insert Grades for Students</h4>
                    </div>
                    <form id="course_details_form" action="includes/course_details.inc.php" method="post">
                        <div class="modal-body">


                            <div class="form-group col-md-12">
                                <div class="col-md-6">
                                    <label>Student Name:</label>
                                    <input type="text" class="form-control" name="student_toassign" id="student_toassign" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label>Grade Identifier:</label>
                                    <div>
                                        <select class="form-control" name="grade_identifiers" id="grade_identifiers">
                                            <option value="-1">--Select One--</option>
                                            {grade_identifiers_dd}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-12" style="margin-top: 25px">
                                <div class="col-md-4">
                                    <label for="punctuation">Punctuation</label>
                                    <input type="text" class="form-control" name="punctuation" id="punctuation" required>
                                </div>
                                <div class="col-md-4">
                                    <label for="valor">Valor</label>
                                    <input type="text" class="form-control" name="valor" id="valor" readonly required>
                                </div>
                                <div class="col-md-4">
                                    <label for="txt_grade">Grade</label>
                                    <input type="text" class="form-control" name="txt_grade" id="txt_grade" readonly required>
                                </div>
                                <input type="hidden" name="grade0" id="grade0" value="">
                                <input type="hidden" name="group0" id="group0" value="">
                                <input type="hidden" name="course0" id="course0" value="">
                                <input type="hidden" name="teacher0" id="teacher0" value="">
                                <input type="hidden" name="student0" id="student0" value="">
                                <input type="hidden" name="form_action2" id="form_action2" value="2">
                            </div>
                            <br/>
                            <div class="row" style="clear: both">
                                <div class="modal-footer" style="margin-top: 25px">
                                    <button type="button" id="clear_grades" class="btn btn-default" data-dismiss="modal">Close</button>
                                    <button type="button" id="create_grade_name_btn" class="btn btn-success">Create Grade Name</button>
                                    <button type="submit" class="btn btn-primary">Assign Grade</button>
                                </div>
                            </div>


                        </div>
                    </form>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->

        <!-- Small modal -->
        <div class="modal fade bs-example-modal-sm" id="create_grade_name" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog modal-sm" role="document">
                <div class="modal-content">
                    <form id="identifier_form">
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="grade_name">Grade Name</label>
                                <input type="text" class="form-control" id="grade_name" required>
                            </div>
                            <div class="form-group">
                                <label for="grade_name">Valor</label>
                                <input type="text" class="form-control valor_value" id="grade_valor" required>
                            </div>
                            <div class="modal-footer">
                                <button type="button" id="clear_grade_name" class="btn btn-default" data-dismiss="modal">Close</button>
                                <button type="button" id="submit_grade_name" class="btn btn-primary">Create Name</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!--Modal para editar la nota-->
        <div class="modal fade" id="edit_grade" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">Edit Student Grade</h4>
                    </div>
                        <div class="modal-body">
                            <div class="form-group col-md-12">
                                <div class="col-md-8">
                                    <label for="student_name">Student:</label>
                                    <input type="text" class="form-control" name="student_name_1" id="student_name_1" readonly>
                                </div>
                            </div>
                            <div class="form-group col-md-12">
                                <div class="col-md-8">
                                    <label for="punctuation">Grade Identifier:</label>
                                    <input type="text" class="form-control" name="grade_identifier_1" id="grade_identifier_1" readonly>
                                </div>
                            </div>
                            <div class="form-group col-md-12" style="margin-top: 25px">
                                <div class="col-md-4">
                                    <label for="punctuation_1">Punctuation</label>
                                    <input type="text" class="form-control" name="punctuation_1" id="punctuation_1" value="" required>
                                </div>
                                <div class="col-md-4">
                                    <label for="valor_1">Valor</label>
                                    <input type="text" class="form-control" name="valor_1" id="valor_1" value="" readonly>
                                </div>
                                <div class="col-md-4">
                                    <label for="txt_grade_1">Grade</label>
                                    <input type="text" class="form-control" name="txt_grade_1" id="txt_grade_1" value="" readonly>
                                </div>
                            </div>
                            <input type="hidden" name="hdn_grade_1" id="hdn_grade_1" value="" readonly>
                            <br/>
                            <div class="row" style="clear: both">
                                <div class="modal-footer" style="margin-top: 25px">
                                    <button type="button" id="clear_grades_1" class="btn btn-default" data-dismiss="modal">Close</button>
                                    <button type="button" id="btn_edit_grade" class="btn btn-primary">Edit Grade</button>
                                </div>
                            </div>
                        </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
    </div>
</div>

<!--<img src="assets2/global/img/ajax-loader.gif" id="loading_image" class="ajax_loader" >-->
<!--<img src="assets2/global/img/ajax-loader.gif" id="loading_image" class="ajax_loader" style="display:none">-->




<div class="row">
    <div class="col-md-12">
        <!-- BEGIN EXAMPLE TABLE PORTLET-->
        <div class="portlet box blue-hoki">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-book"></i>Student Grades
                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse">
                    </a>
                    <!--<a href="#portlet-config" data-toggle="modal" class="config">-->
                    </a>
                    <a href="javascript:;" class="reload">
                    </a>
                    <!--<a href="javascript:;" class="remove">-->
                    </a>
                </div>
            </div>
            <div class="portlet-body">
                <div class="table-toolbar">
                    <div class="row">
                        <div class="col-md-6">

                        </div>
                        <div class="col-md-6">
                            <div class="btn-group pull-right" style="margin-right: 10px">
                                <button class="btn dropdown-toggle" data-toggle="dropdown">Tools <i class="fa fa-angle-down"></i>
                                </button>
                                <ul class="dropdown-menu pull-right">
                                    <li>
                                        <a href="#">
                                            Print </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            Save as PDF </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            Export to Excel </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="overflow: scroll">
                    <table class="table table-striped table-bordered table-hover table-responsive" data-toggle="table" data-pagination="true" id="grades_table">
                        <thead>
                        <tr>
                            <th>
                                ID
                            </th>
                            <th>
                                Student Name
                            </th>
                            {header_columns}
                        </tr>
                        </thead>
                        <tbody>
                        {students_grades}

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    $(document).ready(function(){

        (function($) {
            $.get = function(key)   {
                key = key.replace(/[\[]/, '\\[');
                key = key.replace(/[\]]/, '\\]');
                var pattern = "[\\?&]" + key + "=([^&#]*)";
                var regex = new RegExp(pattern);
                var url = unescape(window.location.href);
                var results = regex.exec(url);
                if (results === null) {
                    return null;
                } else {
                    return results[1];
                }
            }
        })(jQuery);

        var grade_insert =$.get("grade_insert");

        if(grade_insert == 1){
            alert("Grade assingned succesfully");
        }
        if(grade_insert == 2){
            alert("Problems in process, try again");
        }


        $('.valor_value').mask('000');
        $('#loading_image').hide();
    });

    function insert_grade(id){

        grade0 = $('#grade').val();
        group0 = $('#group').val();
        course0 = $('#course').val();
        teacher0 = $('#teacher').val();
        student0 = $('#td_'+id).text();

        var student_toassign = $('#tdn_'+id).text();
        $('#student_toassign').val(student_toassign);
        $('#grade0').val(grade0);
        $('#group0').val(group0);
        $('#course0').val(course0);
        $('#teacher0').val(teacher0);
        $('#student0').val(student0);
        $('#create_grade').modal('show');

    }

    //Calculate grade
    $("#punctuation").blur(function(){

        punctuation = $(this).val();
        valor = $('#valor').val();
        var pct = (punctuation / valor) * 100;

        if(pct >= 90){
            grade_descr = "A";
        }else if(pct >= 80 && pct < 90){
            grade_descr = "B";
        }else if(pct >= 70 && pct < 80){
            grade_descr = "C";
        }else if(pct >= 60 && pct < 70){
            grade_descr = "D";
        }else{
            grade_descr = "F";
        }

        $('#txt_grade').val(grade_descr);

    });

    //Calculate grade
    $("#punctuation_1").blur(function(){

        punctuation = $(this).val();
        valor = $('#valor_1').val();
        var pct = (punctuation / valor) * 100;

        if(pct >= 90){
            grade_descr = "A";
        }else if(pct >= 80 && pct < 90){
            grade_descr = "B";
        }else if(pct >= 70 && pct < 80){
            grade_descr = "C";
        }else if(pct >= 60 && pct < 70){
            grade_descr = "D";
        }else{
            grade_descr = "F";
        }

        $('#txt_grade_1').val(grade_descr);

    });

    $('#create_grade_name_btn').click(function(){
        $('#create_grade_name').modal('show');
    });

    $('#submit_grade_name').click(function(){

        if( $('#grade_name').val() == "" ){
            alert("Grade name is required");
            return false;
        }

        grade = $('#grade').val();
        group = $('#group').val();
        course = $('#course').val();
        teacher = $('#teacher').val();
        grade_name = $('#grade_name').val();
        grade_valor = $('#grade_valor').val();

        $.ajax({

            url: "includes/ajax.grade_identifier.php",
            method: "POST",
            data: {'action': 'insert', 'grade': grade, 'group': group, 'course': course, 'teacher': teacher, 'grade_name': grade_name, 'grade_valor': grade_valor},

            success: function(response){

                if(response){
                    $('#create_grade_name').modal('hide');
                    $('#grade_name').val("");
                    $('#grade_valor').val("");

                    $.ajax({
                        url: "includes/ajax.grade_identifier.php",
                        method: "POST",
                        data: {'action': 'recreate', 'grade': grade, 'group': group, 'course': course, 'teacher': teacher},

                        success: function(response){
                            $('#grade_identifiers').html(response);
                        }
                    })

                }else{
                    alert("Problems creating, try again!");
                }

            }

        });

    });

    $('#grade_identifiers').change(function(){

        if( $('#grade_identifiers').val() > 0 ){

            id = $('#grade_identifiers').val();
            $.ajax({

                url: "includes/ajax.get_valor.php",
                method: "POST",
                data: {'id': id},

                success: function(response){
                    $('#valor').val(response);
                }

            });

        }

    });

    $(function() {
        $("#day_status_date").datepicker({
            dateFormat: "yy-mm-dd"
        });
    });

    $('#course_details_form').submit(function(){

        if($('#grade_identifiers').val() === '-1'){
            alert('Grade Identifier is required');
            return false;
        }

        if($('#punctuation').val() === ''){
            alert('Punctuation is required');
            return false;
        }

        if($('#valor').val() === ''){
            alert('Valor is required');
            return false;
        }

        if($('#txt_grade').val() === ''){
            alert('Grade is required');
            return false;
        }

    });

    $('#clear_grades').click(function(){
        $('#grade_identifiers').val('');
        $('#punctuation').val('');
        $('#valor').val('');
        $('#txt_grade').val('');
    });

    $('#clear_grade_name').click(function(){
        $('#grade_name').val('');
        $('#grade_valor').val('');

    });

    $(document).on('click','.grade_selector', function(){

        var grade_id = this.id;
        $("#hdn_grade_1").val(grade_id);
        $("#edit_grade").modal("show");

        $.ajax({
            url: "includes/ajax.edit_grades.php",
            method: "POST",
            data: {'action': 1, 'id': grade_id},

            success: function(response){

                obj = jQuery.parseJSON(response);
                $("#student_name_1").val(obj[0]);
                $("#grade_identifier_1").val(obj[1]);
                $("#punctuation_1").val(obj[2]);
                $("#valor_1").val(obj[3]);
                $("#txt_grade_1").val(obj[4]);

            }

        });

    });

    $("#btn_edit_grade").click(function(){

        grades_1 = $('#grade').val();
        group_1 = $('#group').val();
        course_1 = $('#course').val();

        var grade_id = $("#hdn_grade_1").val();
        var punctuation_1 = $("#punctuation_1").val();
        var valor_1 = $("#valor_1").val();
        var grade_1 = $("#txt_grade_1").val();

        $.ajax({
            url: "includes/ajax.edit_grades.php",
            method: "POST",
            data: {'action': 2, 'id': grade_id, 'punctuation_1': punctuation_1, 'valor_1': valor_1, 'grade_1': grade_1},

            success: function(response){
                //alert(response);
                if(response === "done"){
                    window.location.replace("display_page.php?tpl=course_details&grade_id="+grades_1+"&group_id="+group_1+"&course_id="+course_1);
                }
            }

        });

    });

    $("#submit_notifications").click(function(){
        $('#loading_image').show();
    });


</script>